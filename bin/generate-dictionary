#!/usr/bin/env babel-node

import fs from 'fs';
import request from 'request';
import path from 'path';
import nomnom from 'nomnom';
import process from 'process';
import cheerio from 'cheerio';
import countries from '../src/countries';

const exists = (filename) => fs.existsSync(filename)
  ? undefined
  : `${filename} does not exist`;

let { destination } = nomnom
  .script('generate-dictionary')
  .option('destination', { required: true, callback: exists })
  .parse();

const all = countries.getAll();
const dictionary = {
  COUNTRY: all.map(country => country.name)
    .filter(value => !!value),
  CAPITAL: all.map(country => country.capital)
    .filter(value => !!value),
  CONTINENT: [...new Set(all.map(country => country.region))]
};

const dictionaryFile = path.join(process.cwd(), destination, 'dictionary.json');
fs.writeFile(dictionaryFile, JSON.stringify(dictionary, null, 2), 'utf8', (err) => {
  if (err) {
    process.exit(1);
  }
});
