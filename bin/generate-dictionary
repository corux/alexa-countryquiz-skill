#!/usr/bin/env babel-node

import fs from 'fs';
import path from 'path';
import nomnom from 'nomnom';
import process from 'process';
import countryjs from 'countryjs';
import availableFlags from 'svg-country-flags/countries.json';

const exists = (filename) => fs.existsSync(filename)
  ? undefined
  : `${filename} does not exist`;

let { destination } = nomnom
  .script('generate-dictionary')
  .option('destination', { required: true, callback: exists })
  .parse();

const destinationFile = path.join(process.cwd(), destination, 'dictionary.json');
const dictionary = {
  COUNTRY: Object.keys(availableFlags).map(value => {
    const translations = countryjs.translations(value);
    if (translations && translations['de']) {
      return translations['de'];
    }
  }).filter(value => !!value)
};

fs.writeFile(destinationFile, JSON.stringify(dictionary, null, 2), 'utf8', (err) => {
  if (err) {
    process.exit(1);
  }
  process.exit(0);
});
