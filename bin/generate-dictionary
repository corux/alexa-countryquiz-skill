#!/usr/bin/env babel-node

import fs from 'fs';
import path from 'path';
import nomnom from 'nomnom';
import process from 'process';
import countryjs from 'countryjs';

const exists = (filename) => fs.existsSync(filename)
  ? undefined
  : `${filename} does not exist`;

let { destination } = nomnom
  .script('generate-dictionary')
  .option('destination', { required: true, callback: exists })
  .parse();

const i18nContinents = {
  Asia: "Asien",
  Europe: "Europa",
  Africa: "Afrika",
  Oceania: "Ozeanien",
  Americas: "Amerika"
};

const all = countryjs.all();
const destinationFile = path.join(process.cwd(), destination, 'dictionary.json');
const dictionary = {
  COUNTRY: all.map(country => country.translations && country.translations['de'])
    .filter(value => !!value),
  CAPITAL: all.map(country => country.capital)
    .filter(value => !!value),
  CURRENCY: [...new Set([].concat(...all.map(country => country.currencies)))]
    .filter(value => !!value),
  CONTINENT: [...new Set(all.map(country => country.region))]
    .map(continent => i18nContinents[continent])
    .filter(value => !!value)
};

fs.writeFile(destinationFile, JSON.stringify(dictionary, null, 2), 'utf8', (err) => {
  if (err) {
    process.exit(1);
  }
  process.exit(0);
});
